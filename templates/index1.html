<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MemeInsight</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–π –ø–∞–Ω–µ–ª–∏ */
        .navigation {
            display: flex;
            gap: 20px;
        }

        .navigation a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            transition: all 0.3s;
        }

        .navigation a:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ —Å–µ–∫—Ü–∏–∏ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ */
        .nav-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .nav-button {
            background-color: #6200ee;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .nav-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(98, 0, 238, 0.3);
            background-color: #5000d6;
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ */
        .features-container {
            background-color: white;
            padding: 50px 20px;
            text-align: center;
            margin-top: 50px;
        }

        .features-title {
            font-size: 2rem;
            margin-bottom: 30px;
            color: #333;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="project-name">MemeInsight</div>
        <!-- –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–æ–µ –º–µ–Ω—é -->
        <nav class="navigation">
            <a href="/" class="active">–ì–ª–∞–≤–Ω–∞—è</a>
            <a href="/top-memes">–¢–æ–ø –º–µ–º–æ–≤</a>
            <a href="/filter-memes">–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è</a>
        </nav>
    </header>

    <section class="welcome-section">
        <div class="welcome-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MemeInsight ‚Äî –≤–∞—à –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –≤ –º–∏—Ä –º–µ–º–æ–≤!</div>
        <div class="welcome-subtitle">–ò—Å—Å–ª–µ–¥—É–π—Ç–µ –º–µ–º—ã —Å –Ω–∞–º–∏ üöÄ</div>
        <button class="start-button">–ù–∞—á–∞—Ç—å</button>

        <!-- –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é -->
        <div class="nav-buttons" style="margin-top: 30px;">
            <a href="/top-memes" class="nav-button">–¢–æ–ø –º–µ–º–æ–≤</a>
            <a href="/filter-memes" class="nav-button">–§–∏–ª—å—Ç—Ä –º–µ–º–æ–≤</a>
        </div>
    </section>

    <div id="3d-container" class="model-container"></div>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º —Å–µ–∫—Ü–∏—é —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏ –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
    <section class="features-container">
        <h2 class="features-title">–¢–æ–ø –º–µ–º—ã</h2>

        <div class="content-sections-container">
            <section class="content-section">
                <h2 class="content-title">–¢—É—Ç</h2>
                <div class="content-image">
                    <img src="{{ url_for('static', filename='images/img.png') }}" alt="–¢—Ä–∞–º–ø">
                </div>
            </section>

            <section class="content-section">
                <h2 class="content-title">–ó–¥–µ—Å—å</h2>
                <div class="content-image">
                    <img src="{{ url_for('static', filename='images/img_1.png') }}" alt="–¢—Ä–∞–º–ø">
                </div>
            </section>

            <section class="content-section">
                <h2 class="content-title">–¢—É—Ç</h2>
                <div class="content-image">
                    <img src="{{ url_for('static', filename='images/img_2.png') }}" alt="–¢—Ä–∞–º–ø">
                </div>
            </section>
        </div>

        <div class="nav-buttons" style="margin-top: 40px;">
            <a href="/top-memes" class="nav-button">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ç–æ–ø –º–µ–º–∞–º VK</a>
            <a href="/filter-memes" class="nav-button">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –º–µ–º–æ–≤</a>
        </div>
    </section>

    <section class="upload-section">
        <h2 class="upload-title">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–≤–æ–π –º–µ–º</h2>
        <div class="upload-container">
            <div class="upload-zone" id="dropZone">
                <input type="file" id="imageInput" accept="image/*" style="display: none;">
                <div class="upload-icon"></div>
                <div class="upload-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å –º–µ–º</div>
                <img id="imagePreview" src="#" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –º–µ–º–∞" style="display: none;">
            </div>
            <textarea id="promptInput" rows="3" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ –º–µ–º–µ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –æ–±—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞"></textarea>
            <button id="uploadBtn" class="analyze-button">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            <div class="loading" id="loading">–ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –º–µ–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</div>
        </div>
        <div class="analysis-output" id="analysisOutput">
            <div class="analysis-message" id="response"></div>
        </div>

        <!-- –î–æ–±–∞–≤–ª—è–µ–º –µ—â–µ —Ä–∞–∑ –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ–¥ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º -->
        <div class="nav-buttons" style="margin-top: 40px;">
            <a href="/top-memes" class="nav-button">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–æ–ø –º–µ–º–æ–≤</a>
            <a href="/filter-memes" class="nav-button">–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –º–µ–º—ã</a>
        </div>
    </section>

    <!-- –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–≤—Å–µ–≥–¥–∞ –≤–∏–¥–Ω–∞) -->
    <div style="position: fixed; bottom: 20px; right: 20px; z-index: 100;">
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <a href="/top-memes" style="background-color: #6200ee; color: white; border-radius: 50%; width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; text-decoration: none; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
                <span style="font-size: 12px; text-align: center;">–¢–æ–ø<br>–º–µ–º–æ–≤</span>
            </a>
            <a href="/filter-memes" style="background-color: #6200ee; color: white; border-radius: 50%; width: 60px; height: 60px; display: flex; justify-content: center; align-items: center; text-decoration: none; box-shadow: 0 4px 10px rgba(0,0,0,0.2);">
                <span style="font-size: 12px; text-align: center;">–§–∏–ª—å—Ç—Ä<br>–º–µ–º–æ–≤</span>
            </a>
        </div>
    </div>

    <script type="module" src="{{ url_for('static', filename='three-scene.js') }}"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const dropZone = document.getElementById('dropZone');
            const imageInput = document.getElementById('imageInput');
            const imagePreview = document.getElementById('imagePreview');
            const uploadBtn = document.getElementById('uploadBtn');
            const loading = document.getElementById('loading');
            const response = document.getElementById('response');
            const analysisOutput = document.getElementById('analysisOutput');

            // –û—Ç–∫—Ä—ã—Ç—å –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∑–æ–Ω—É –∑–∞–≥—Ä—É–∑–∫–∏
            dropZone.addEventListener('click', function() {
                imageInput.click();
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
            imageInput.onchange = function(event) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    imagePreview.style.display = 'block';
                    dropZone.classList.add('has-image');
                };
                if (event.target.files.length > 0) {
                    reader.readAsDataURL(event.target.files[0]);
                }
            };

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            });

            dropZone.addEventListener('dragleave', () => {
                dropZone.classList.remove('drag-over');
            });

            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');

                if (e.dataTransfer.files.length) {
                    imageInput.files = e.dataTransfer.files;
                    const changeEvent = new Event('change');
                    imageInput.dispatchEvent(changeEvent);
                }
            });

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å"
            uploadBtn.onclick = function() {
                if (imageInput.files.length === 0) {
                    alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
                    return;
                }

                var promptText = document.getElementById('promptInput').value.trim() || "–û–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω–æ, —á—Ç–æ —Ç—ã –≤–∏–¥–∏—à—å –Ω–∞ —ç—Ç–æ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏, –æ–±—ä—è—Å–Ω–∏ —Å–º—ã—Å–ª –º–µ–º–∞ –∏ –µ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ.";

                var formData = new FormData();
                formData.append('file', imageInput.files[0]);
                formData.append('message', promptText);

                loading.style.display = 'block';
                response.textContent = '';
                analysisOutput.classList.remove('visible');

                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    loading.style.display = 'none';
                    analysisOutput.classList.add('visible');

                    if (data.error) {
                        response.textContent = '–û—à–∏–±–∫–∞: ' + data.error;
                    } else {
                        response.textContent = data.analysis;
                    }
                })
                .catch(error => {
                    loading.style.display = 'none';
                    analysisOutput.classList.add('visible');
                    response.textContent = '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + error;
                });
            };

            // –ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å"
            document.querySelector('.start-button').addEventListener('click', function() {
                document.querySelector('.upload-section').scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
    </script>
</body>
</html>